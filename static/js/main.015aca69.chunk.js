(this["webpackJsonphabitica-tracker"]=this["webpackJsonphabitica-tracker"]||[]).push([[0],{110:function(e,t,a){},111:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),l=a(25),c=a.n(l),o=(a(33),a(3)),s=a(5),i=a.n(s),u=(a(34),a(13)),m=a.n(u),d=a(4),f=a.n(d),E=a(27);function p(){return(p=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e}).apply(this,arguments)}function h(e,t){if(null==e)return{};var a,n,r=function(e,t){if(null==e)return{};var a,n,r={},l=Object.keys(e);for(n=0;n<l.length;n++)a=l[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,t);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(n=0;n<l.length;n++)a=l[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}var v=r.a.createElement("path",{fillRule:"evenodd",d:"M10.667 10.667L16 8l-5.333-2.667L8 0 5.333 5.333 0 8l5.333 2.667L8 16z"}),b=function(e){var t=e.svgRef,a=e.title,n=h(e,["svgRef","title"]);return r.a.createElement("svg",p({width:16,height:16,viewBox:"0 0 16 16",ref:t},n),a?r.a.createElement("title",null,a):null,v)},y=r.a.forwardRef((function(e,t){return r.a.createElement(b,p({svgRef:t},e))}));a.p,a(38);function w(e){var t,a,l=Object(n.useContext)(P),c=["task-icon-container","center-wrapper",k(e.task)].join(" "),o=Array((t=e.task.priority,Math.ceil(t/.5))).fill(r.a.createElement(y,{fill:"white","aria-hidden":!0})),s=e.task.value.toFixed(1);return e.task.nextDue&&(a=f()(e.task.nextDue[0])),l.showTaskIcons?r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{"data-tip":!0,"data-for":e.task.id,className:c},o),r.a.createElement(E.a,{id:e.task.id,place:"left",effect:"solid"},a?r.a.createElement("div",null,r.a.createElement("b",null,"Next due:")," ",function(e){var t=f()();return e.diff(t,"days")<1?"tomorrow":e.diff(t,"days")<6?e.format("dddd"):e.year===f()().year?e.format("ddd MMM D"):e.format("MMM D YYYY")}(a)):null,r.a.createElement("div",null,r.a.createElement("b",null,"Task value:")," ",s))):null}var O=[-16,-9,-1,1,6,12],N=["worst","worse","bad","neutral","good","better"];function k(e){for(var t=0;t<O.length;t++)if(e.value<O[t])return N[t];return"best"}var S=a(14);function g(e){var t=Object(n.useContext)(P);return r.a.createElement("tr",null,r.a.createElement("th",null,r.a.createElement("div",{className:"section-header"},r.a.createElement("div",{className:"section-header-title"},r.a.createElement("h2",null,e.title),r.a.createElement("div",{role:"button",className:"show-no-history clickable",title:"Show/Hide tasks with no data",onClick:function(){return e.setShowNoHistory(!e.showNoHistory)}},e.showNoHistory?r.a.createElement(S.a,{"aria-hidden":"true"}):r.a.createElement(S.b,{"aria-hidden":"true"}))))),t.dates.map((function(e){return r.a.createElement("th",null,r.a.createElement("div",{className:"date date-heading"},r.a.createElement("span",null,e.format("ddd")),r.a.createElement("span",null,e.format("DD"))))})))}var j=a(7);function T(e){var t=Object(n.useState)(!1),a=Object(o.a)(t,2),l=a[0],c=a[1];return r.a.createElement("section",{className:"dailys"},r.a.createElement("table",null,r.a.createElement(g,{title:"Dailies",setShowNoHistory:c,showNoHistory:l}),e.data.map((function(e){return r.a.createElement(M,{showNoHistory:l,daily:e})}))),r.a.createElement("div",{className:"link show-no-history",onClick:function(){return c(!l)}}))}function M(e){var t=Object(n.useContext)(P),a=new Map,l=e.daily,c=l.text,o=l.history;i.a.debug(c);for(var s=0;s<o.length;s++){var u=void 0;u=0===s?o[s].value:o[s].value-o[s-1].value;var m=f()(o[s].date);if(i.a.debug(m.format("YYYY-MM-DD HH:mm:ss")+": "+o[s].value),0!==u){t.cronIntervals.search(m.unix(),m.unix()).length>0&&(a.has(m.format(G))?i.a.debug("Multiple daily completions on for ".concat(c," on ").concat(m)):m=m.subtract(1,"day"));var d=m.format(G);a.set(d,u)}}var E=t.dates.map((function(e){return e.format(G)})).map((function(e){return a.get(e)}));return 0!==E.filter((function(e){return void 0!==e})).length||e.showNoHistory?r.a.createElement("tr",null,r.a.createElement("td",{className:"task-name-row"},r.a.createElement(w,{task:e.daily}),r.a.createElement("span",{className:"task-name",dangerouslySetInnerHTML:{__html:j.render(c)}})),E.map((function(e){return r.a.createElement(D,{delta:e})}))):null}function D(e){var t,a=["daily-cell"];return e.delta&&0!==e.delta?e.delta>0?(a.push("success"),t="\u2713"):(a.push("fail"),t="\u2716"):(a.push("pass"),t="\xa0"),r.a.createElement("td",{className:a.join(" ")},t&&r.a.createElement("div",{className:"center-wrapper"},r.a.createElement("span",{className:"symbol"},t)))}var C=a(26),H=a(7);function R(e){var t=Object(n.useState)(!1),a=Object(o.a)(t,2),l=a[0],c=a[1];return r.a.createElement("section",{className:"habits"},r.a.createElement("table",null,r.a.createElement(g,{title:"Habits",setShowNoHistory:c,showNoHistory:l}),e.data.map((function(e){return r.a.createElement(I,{showNoHistory:l,habit:e})}))))}function I(e){var t=Object(n.useContext)(P),a=new Map,l=e.habit,c=l.text,o=l.history;i.a.debug(c);var s,u=Object(C.a)(o);try{for(u.s();!(s=u.n()).done;){var m=s.value,d=f()(m.date).format(G);i.a.debug(JSON.stringify(m)),void 0!==m.scoredUp&&void 0!==m.scoredDown&&a.set(d,[m.scoredUp,m.scoredDown])}}catch(p){u.e(p)}finally{u.f()}var E=t.dates.map((function(e){return e.format(G)})).map((function(e){return a.get(e)}));return 0!==E.filter((function(e){return void 0!==e})).length||e.showNoHistory?r.a.createElement("tr",null,r.a.createElement("td",{className:"task-name-row"},r.a.createElement(w,{task:e.habit}),r.a.createElement("span",{className:"task-name",dangerouslySetInnerHTML:{__html:H.render(c)}})),E.map((function(e){return e?r.a.createElement(_,{up:e[0],down:e[1]}):r.a.createElement("td",{className:"habit-cell"},"\xa0")}))):null}function _(e){return r.a.createElement("td",{className:"habit-cell"},r.a.createElement("div",{className:"habit-score-container"},e.up>0&&r.a.createElement("div",{className:"success center-wrapper"},r.a.createElement("span",null,"+",e.up)),e.down>0&&r.a.createElement("div",{className:"fail center-wrapper"},r.a.createElement("span",null,"-",e.down))))}a(110);var x=a(7);function A(e){var t=Object(n.useContext)(P).dates[0],a=e.data.filter((function(e){return f()(e.dateCompleted).isAfter(t)}));return r.a.createElement("section",{className:"todos"},r.a.createElement("h2",null,"Completed Todos"),r.a.createElement("ul",null,a.map((function(e){return r.a.createElement(Y,{todo:e})}))))}function Y(e){var t=f()(e.todo.dateCompleted).format("MMM D");return r.a.createElement("li",{className:"todo-row"},r.a.createElement(w,{task:e.todo}),r.a.createElement("span",{className:"todo-date date"},t),r.a.createElement("div",{className:"task-name",dangerouslySetInnerHTML:{__html:x.render(e.todo.text)}}))}var P=r.a.createContext({showTaskIcons:!0,dates:Array(),cronIntervals:new m.a});function F(e){var t=Object(n.useState)(!0),a=Object(o.a)(t,2),l=a[0],c=a[1],s=Object(n.useState)(!0),i=Object(o.a)(s,2),u=i[0],d=i[1],E=Object(n.useState)(!0),p=Object(o.a)(E,2),h=p[0],v=p[1],b=Object(n.useState)(7),y=Object(o.a)(b,2),w=y[0],O=y[1],N=Object(n.useState)(!0),k=Object(o.a)(N,2),S=k[0],g=k[1],j=Object(n.useState)([]),M=Object(o.a)(j,2),D=M[0],C=M[1],H=Object(n.useState)([]),I=Object(o.a)(H,2),_=I[0],x=I[1],Y=Object(n.useState)([]),F=Object(o.a)(Y,2),G=F[0],B=F[1],J=Object(n.useState)([]),K=Object(o.a)(J,2),W=K[0],z=K[1],$=e.userId,q=e.userApiKey,Q=function(e){return fetch(e,{method:"GET",headers:{"Content-Type":"application/json","x-api-user":$,"x-api-key":q,"x-client":"0d9428fd-d6fa-45f3-a4db-f130e3ef10ea-HabiticaTracker"}})},V=function(e){if(!e.success)throw new Error(e.message);return e},X=e.setError;if(Object(n.useEffect)((function(){Q("https://habitica.com/api/v3/user").then((function(e){return e.json()})).then(V).then((function(e){C(e.data.history.exp.map((function(e){var t=f()(e.date);return[t.unix()-60,t.unix()+60]}))),c(!1)}),(function(e){X(e)}))}),[]),Object(n.useEffect)((function(){Q("https://habitica.com/api/v3/tasks/user").then((function(e){return e.json()})).then(V).then((function(e){x(e.data.filter((function(e){return"habit"===e.type}))),B(e.data.filter((function(e){return"daily"===e.type}))),d(!1)}),(function(e){X(e)}))}),[]),Object(n.useEffect)((function(){Q("https://habitica.com/api/v3/tasks/user?type=completedTodos").then((function(e){return e.json()})).then(V).then((function(e){z(e.data.filter((function(e){return"todo"===e.type}))),v(!1)}),(function(e){X(e)}))}),[]),l||u||h)return r.a.createElement("div",{className:"App"},r.a.createElement("p",null,"Loading..."));e.setAppState(L.DATA_FETCH_SUCCESS);var Z=new m.a;D.forEach((function(e){return Z.insert(e[0],e[1],!0)}));var ee,te={showTaskIcons:S,dates:(ee=w,Array(ee).fill(0).map((function(e,t){return t+1})).reverse().map((function(e){return f()().subtract(e,"days").startOf("day")}))),cronIntervals:Z};return r.a.createElement("div",{className:"App"},r.a.createElement(P.Provider,{value:te},r.a.createElement(U,{numDaysToShow:w,setNumDaysToShow:O,toggleTaskIcons:function(){return g(!S)}}),r.a.createElement(R,{data:_}),r.a.createElement(T,{data:G}),r.a.createElement(A,{data:W})))}function U(e){var t=Object(n.useContext)(P),a=function(e){var t=e[0],a=e[e.length-1];if(t.month()===a.month())return a.format("MMMM YYYY");var n=t.year()===a.year()?"MMM":"MMM YYYY";return[t.format(n),a.format("MMM YYYY")].join("\u2013")}(t.dates);return r.a.createElement("div",{className:"app-controls"},r.a.createElement("div",null,r.a.createElement("span",{role:"button",className:"link",onClick:function(){return e.setNumDaysToShow(e.numDaysToShow+7)}},"+1 week"),e.numDaysToShow>7?r.a.createElement("span",null,r.a.createElement("span",null," / "),r.a.createElement("span",{role:"button",className:"link",onClick:function(){return e.setNumDaysToShow(e.numDaysToShow-7)}},"-1 week")):null),r.a.createElement("div",{className:"date-header"},a),r.a.createElement("span",{role:"button",className:"link",onClick:e.toggleTaskIcons,title:"Show/Hide task icons"},t.showTaskIcons?"Hide":"Show"," Task Icons"))}var L,G="YYYYMMDD";!function(e){e[e.PROMPT_FOR_USER_CREDS=0]="PROMPT_FOR_USER_CREDS",e[e.FETCHING_DATA=1]="FETCHING_DATA",e[e.DATA_FETCH_SUCCESS=2]="DATA_FETCH_SUCCESS",e[e.ERROR=3]="ERROR"}(L||(L={}));var B=function(){i.a.setLevel("debug");var e=Object(n.useState)(""),t=Object(o.a)(e,2),a=t[0],l=t[1],c=Object(n.useState)(""),s=Object(o.a)(c,2),u=s[0],m=s[1],d=Object(n.useState)(),f=Object(o.a)(d,2),E=f[0],p=f[1],h=Object(n.useState)(L.PROMPT_FOR_USER_CREDS),v=Object(o.a)(h,2),b=v[0],y=v[1];return b===L.PROMPT_FOR_USER_CREDS||b===L.ERROR?r.a.createElement("div",{className:"App"},r.a.createElement("h1",null,"Habitica Tracker"),E&&r.a.createElement("div",{className:"error"},"Error: ",E.message),r.a.createElement("p",null,"This tool displays a history of your Habits, Dailies and Todos in Habitica."),r.a.createElement("p",null,"Your User ID and API key can be found on the"," ",r.a.createElement("a",{href:"https://habitica.com/user/settings/api",target:"_blank",rel:"noopener noreferrer"},"Settings > API")," ","page in Habitica."),r.a.createElement("form",{className:"user-api-form"},r.a.createElement("div",{className:"label-container"},r.a.createElement("div",{className:"label"},"User ID"),r.a.createElement("input",{type:"text",className:"user-id",value:a,onChange:function(e){l(e.target.value)}})),r.a.createElement("div",{className:"label-container"},r.a.createElement("span",{className:"label"},"API Key"),r.a.createElement("input",{type:"password",className:"api-key",value:u,onChange:function(e){m(e.target.value)},minLength:36})),r.a.createElement("div",{className:"submit-wrapper"},r.a.createElement("input",{type:"submit",value:"Fetch My Data",onClick:function(e){e.preventDefault(),y(L.FETCHING_DATA)}}))),r.a.createElement("h2",null,"Note"),r.a.createElement("ul",null,r.a.createElement("li",null,"Your user ID and API key will be sent to the Habitica servers and nowhere else."),r.a.createElement("li",null,"This app does not change your Habitica account data. It only fetches and displays data."))):r.a.createElement(F,{userId:a,userApiKey:u,setError:function(e){p(e),y(L.ERROR)},setAppState:y})};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));c.a.render(r.a.createElement(r.a.StrictMode,null,r.a.createElement("div",{className:"app-wrapper"},r.a.createElement(B,null))),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))},28:function(e,t,a){e.exports=a(111)},33:function(e,t,a){},34:function(e,t,a){},38:function(e,t,a){}},[[28,1,2]]]);
//# sourceMappingURL=main.015aca69.chunk.js.map